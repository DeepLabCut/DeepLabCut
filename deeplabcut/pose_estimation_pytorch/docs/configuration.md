# Model Configuration

Model architectures in DeepLabCut PyTorch are defined using configuration files written in YAML format. These configuration files specify the model architecture, training hyperparameters, data augmentation settings, and more.

## Configuration File Structure

The primary configuration file is named `pytorch_cfg.yaml` and is stored in the model's training directory. This file is automatically generated during the standard DeepLabCut workflow, but can also be created manually for custom projects.

## Creating Configuration Files

The [`deeplabcut.pose_estimation_pytorch.config`][] module provides functions to create and manipulate configuration files.

### Basic Configuration Creation

Use [`make_pytorch_pose_config`][deeplabcut.pose_estimation_pytorch.config.make_pytorch_pose_config] to generate a model configuration:

```python
from pathlib import Path
import deeplabcut.pose_estimation_pytorch as dlc_torch

# Configuration for a DeepLabCut project
project_cfg = {
    "bodyparts": ["nose", "left_ear", "right_ear", "tail_base"],
    "individuals": ["mouse1", "mouse2"],
    # ... other project settings
}

pose_config_path = Path("/path/to/model/train")
model_cfg = dlc_torch.config.make_pytorch_pose_config(
    project_config=project_cfg,
    pose_config_path=pose_config_path,
    net_type="hrnet_w32",
    top_down=True,
    save=True,  # Save the configuration to disk
)
```

### Configuration for COCO Datasets

For COCO-format datasets without a DeepLabCut project, use [`make_basic_project_config`][deeplabcut.pose_estimation_pytorch.config.make_basic_project_config]:

```python
from pathlib import Path
import deeplabcut.pose_estimation_pytorch as dlc_torch

# Create a minimal project configuration
project_cfg = dlc_torch.config.make_basic_project_config(
    dataset_path="/path/to/COCOProject",
    bodyparts=["nose", "left_eye", "right_eye", "left_ear", "right_ear"],
    max_individuals=2,
    multi_animal=True,
)

# Generate model configuration
model_cfg = dlc_torch.config.make_pytorch_pose_config(
    project_config=project_cfg,
    pose_config_path=Path("/path/to/experiment/train"),
    net_type="dlcrnet_ms5",
    top_down=False,
    save=True,
)
```

## Configuration File Components

A complete `pytorch_cfg.yaml` file contains several sections:

- Model Architecture: specifies the backbone, neck, and head components:

- Training Parameters: Defines the optimization strategy and training loop settings:

- Data Configuration: Specifies data augmentation and preprocessing for training and inference:

- Data Augmentation Options: transformations are available for the `train` and `inference` configurations. Most augmentations should only be applied during training, not inference.

- Training Settings: Training-specific parameters control batch size, epochs, and data loading:

- Runner Configuration: The runner manages training execution, optimization, and checkpointing:

- Optimizers

- Learning Rate Schedulers: use any scheduler from [`torch.optim.lr_scheduler`](https://pytorch.org/docs/stable/optim.html#how-to-adjust-learning-rate):

- Logging: training runs are logged locally by default. Optionally integrate with [Weights & Biases](https://wandb.ai/site):


- Resuming Training: resume from a specific checkpoint by specifying its path:

```yaml
resume_training_from: /path/to/model/train/snapshot-010.pt
```

- Inference Configuration: configure inference-specific behavior independently of training:

- Top-Down Detector Configuration: Top-down models require a separate detector configuration: